<!DOCTYPE html>
<html>
    <head>
        <title>CanJS 3.0 memory test</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <script type="text/stache" id="my-component">
            value of test property: {{testProperty}}
        </script>

        <script type="text/stache" id="content-using-my-component">
            <div id="my-component-container" />

            {{#if myCompInserted}}
                <a ($click)="removeMyComp()" href="javascript://">Remove</a>
            {{else}}
                <a ($click)="insertMyComp()" href="javascript://">Insert</a>
            {{/if}}
        </script>

        <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="./node_modules/steal/steal.js">
var Component = require("can-component"),
	DefineMap = require("can-define/map/map"),
	stache = require("can-stache");

var MyComponentVM = DefineMap.extend({
    testProperty: { type: "string", value: "init test property value" }
});

Component.extend({
    tag: "my-component",
    view: stache.from("my-component"),
    ViewModel: MyComponentVM
});

var myCompRenderer = stache("<my-component />");

var TestVM = DefineMap.extend({
    myCompInserted: { type: "boolean", value: false },

    insertMyComp: function () {
        var myCompFrag = myCompRenderer();
        $("#my-component-container").html(myCompFrag);
        this.myCompInserted = true;
    },

    removeMyComp: function () {
        $("#my-component-container").empty();
        this.myCompInserted = false;
    }
});

var template = stache.from("content-using-my-component");
var frag = template(new TestVM());
document.body.appendChild(frag);

</script>
    </body>
</html>
